# ุชุบุฑุงุช API ุจุฑุง ุชู ุณุณุชู ฺฉุงุฑุจุฑุงู

**ุชุงุฑุฎ:** 2025-11-29  
**ูุณุฎู API:** 2.0.0

---

## โ ุฎุจุฑ ุฎูุจ: ูุฑูุช API ุชุบุฑ ูฺฉุฑุฏู!

**Request ู Response ููุงู ูุจู ุงุณุช.** ููุท ุฏู ููุฏ ุฌุฏุฏ ุจู Response ุงุถุงูู ุดุฏู.

---

## ๐ค Request Format (ุจุฏูู ุชุบุฑ)

```json
{
  "query": "ุณูุงู ฺฉุงุฑุจุฑ",
  "conversation_id": "uuid-optional",
  "language": "fa",
  "file_attachments": [
    {
      "filename": "contract.pdf",
      "minio_url": "temp_uploads/user123/file.pdf",
      "file_type": "application/pdf",
      "size_bytes": 524288
    }
  ]
}
```

**ููู ููุฏูุง ูุซู ูุจู ุงุณุช!**

---

## ๐ฅ Response Format (ุฏู ููุฏ ุฌุฏุฏ)

### ูุจู:
```json
{
  "answer": "ูพุงุณุฎ...",
  "sources": ["doc-id-1"],
  "conversation_id": "uuid",
  "message_id": "uuid",
  "tokens_used": 1250,
  "processing_time_ms": 3500
}
```

### ุญุงูุง:
```json
{
  "answer": "ูพุงุณุฎ...",
  "sources": ["doc-id-1"],
  "conversation_id": "uuid",
  "message_id": "uuid",
  "tokens_used": 1250,
  "processing_time_ms": 3500,
  
  "file_analysis": "ุชุญูู ูุงูโูุง...",  // โ ุฌุฏุฏ (ุงุฎุชุงุฑ)
  "context_used": true                   // โ ุฌุฏุฏ
}
```

---

## ๐ ููุฏูุง ุฌุฏุฏ ุฏุฑ Response

### 1. `file_analysis` (string | null)
- **ููุน:** ุงุฎุชุงุฑ
- **ุฒูุงู:** ููุท ููุช ูุงู ุงุฑุณุงู ุดุฏู ุจุงุดุฏ
- **ูุญุชูุง:** ุชุญูู ููุดููุฏ ูุงูโูุง ุชูุณุท LLM
- **ูุซุงู:**
  ```json
  "file_analysis": "ูุงู ุถููู ุดุฏู ฺฉ ูุฑุงุฑุฏุงุฏ ฺฉุงุฑ ุงุณุช ฺฉู ุดุงูู 5 ูุงุฏู ูโุจุงุดุฏ. ูฺฉุงุช ฺฉูุฏ: ุญููู 10 ูููู ุชููุงูุ ูุฏุช ูุฑุงุฑุฏุงุฏ 1 ุณุงูุ ูุงุจู ุชูุฏุฏ."
  ```

### 2. `context_used` (boolean)
- **ููุน:** ููุดู ููุฌูุฏ
- **ููุฏุงุฑ:** `true` ุง `false`
- **ูุนู:** ุขุง ุงุฒ ุญุงูุธู ูฺฉุงููุงุช ูุจู ุงุณุชูุงุฏู ุดุฏุ
- **ฺฉุงุฑุจุฑุฏ:** ููุงุด ุจู ฺฉุงุฑุจุฑ ฺฉู ุณุณุชู ูฺฉุงููุงุช ูุจู ุฑุง ุงุฏุด ุงุณุช

---

## โ๏ธ ุชุบุฑุงุช ููู ุฑูุชุงุฑ

### 1. ุญุงูุธู ูฺฉุงููุงุช ูุนุงู ุดุฏ

**ูุจู:**
```
ฺฉุงุฑุจุฑ: ูุงููู ฺฉุงุฑ ฺุณุชุ
ุณุณุชู: ูุงููู ฺฉุงุฑ...

ฺฉุงุฑุจุฑ: ฺูุฏ ูุงุฏู ุฏุงุฑุฏุ
ุณุณุชู: โ ูุชูุฌู ูุดุฏู
```

**ุญุงูุง:**
```
ฺฉุงุฑุจุฑ: ูุงููู ฺฉุงุฑ ฺุณุชุ
ุณุณุชู: ูุงููู ฺฉุงุฑ...
         context_used: false

ฺฉุงุฑุจุฑ: ฺูุฏ ูุงุฏู ุฏุงุฑุฏุ
ุณุณุชู: โ ูุงููู ฺฉุงุฑ 200 ูุงุฏู ุฏุงุฑุฏ
         context_used: true  โ ุงุฒ ูฺฉุงููู ูุจู ุงุณุชูุงุฏู ฺฉุฑุฏ
```

### 2. ุชุญูู ูุงู ุจุง LLM

**ูุจู:**
- ููุท ูุชู ูุงู ุงุณุชุฎุฑุงุฌ ูโุดุฏ
- ุจุฏูู ุชุญูู

**ุญุงูุง:**
- ูุชู ุงุณุชุฎุฑุงุฌ ูโุดูุฏ
- **+ ุชุญูู ููุดููุฏ ุจุง LLM**
- **+ ุงุณุชุฎุฑุงุฌ ูฺฉุงุช ฺฉูุฏ**
- **+ ุงุฑุชุจุงุท ุจุง ุณูุงู ฺฉุงุฑุจุฑ**

---

## ๐ก ุชูุตูโูุง ูพุงุฏูโุณุงุฒ

### 1. ููุงุด ุชุญูู ูุงู (ุงุฎุชุงุฑ)

```javascript
const data = await response.json();

// ุงฺฏุฑ ูุงู ุชุญูู ุดุฏู
if (data.file_analysis) {
  // ููุงุด ุฏุฑ UI
  showFileAnalysisSection(data.file_analysis);
}

// ููุงุด ูพุงุณุฎ
showAnswer(data.answer);
```

### 2. ููุงุด Context Indicator (ุงุฎุชุงุฑ)

```javascript
// ููุงุด ุขฺฉูู ฺฉู ุณุณุชู ุงุฒ ุญุงูุธู ุงุณุชูุงุฏู ฺฉุฑุฏู
if (data.context_used) {
  showContextIcon();  // ูุซูุงู ฺฉ ุขฺฉูู ูุบุฒ ุง ุญุงูุธู
}
```

### 3. ูุฏุฑุช Conversation ID (ููู!)

```javascript
// ุฐุฎุฑู conversation_id ุจุฑุง ุณูุงูุงุช ุจุนุฏ
let conversationId = localStorage.getItem('current_conversation_id');

const response = await fetch('/api/v1/query/', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    query: userQuery,
    conversation_id: conversationId,  // โ ุญุชูุงู ุงุฑุณุงู ฺฉูุฏ
    file_attachments: files
  })
});

const data = await response.json();

// ุฐุฎุฑู ุจุฑุง ุณูุงู ุจุนุฏ
if (!conversationId) {
  localStorage.setItem('current_conversation_id', data.conversation_id);
}
```

---

## ๐ ุณุงุฒฺฏุงุฑ ุจุง ูุณุฎู ูุจู

### โ ฺฉุฏ ูุฏู ุดูุง ฺฉุงุฑ ูโฺฉูุฏ!

ุงฺฏุฑ ููุฏูุง ุฌุฏุฏ ุฑุง ูุงุฏุฏู ุจฺฏุฑุฏุ ููู ฺุฒ ูุซู ูุจู ฺฉุงุฑ ูโฺฉูุฏ:

```javascript
// ฺฉุฏ ูุฏู (ููฺูุงู ฺฉุงุฑ ูโฺฉูุฏ)
const response = await fetch('/api/v1/query/', {
  method: 'POST',
  body: JSON.stringify({
    query: "ุณูุงู ูู"
  })
});

const data = await response.json();
console.log(data.answer);  // โ ฺฉุงุฑ ูโฺฉูุฏ
```

---

## ๐ ุฎูุงุตู ุชุบุฑุงุช

| ููุฑุฏ | ูุจู | ุญุงูุง | ุณุงุฒฺฏุงุฑุ |
|------|-----|------|---------|
| Request Format | โ | โ | โ ุจุฏูู ุชุบุฑ |
| Response Fields (ูุฏู) | โ | โ | โ ุจุฏูู ุชุบุฑ |
| `file_analysis` | โ | โ | โ ุงุฎุชุงุฑ |
| `context_used` | โ | โ | โ ุงุถุงูู ุดุฏู |
| ุญุงูุธู ูฺฉุงููุงุช | โ | โ | โ ุฎูุฏฺฉุงุฑ |
| ุชุญูู ูุงู ุจุง LLM | โ | โ | โ ุฎูุฏฺฉุงุฑ |

---

## ๐ ุงูุฏุงูุงุช ูุงุฒู

### ุงูุฒุงู:
- โ **ูฺ ุชุบุฑ ุงูุฒุงู ูุณุช!**
- ฺฉุฏ ูุนู ุดูุง ุจุฏูู ุชุบุฑ ฺฉุงุฑ ูโฺฉูุฏ

### ูพุดููุงุฏ:
1. โ ุงุฑุณุงู `conversation_id` ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุญุงูุธู
2. โ ููุงุด `file_analysis` ุฏุฑ UI
3. โ ููุงุด `context_used` indicator

---

## ๐ ุณูุงูุงุช ูุชุฏุงูู

### Q: ุขุง ุจุงุฏ ฺฉุฏ ุฎูุฏ ุฑุง ุชุบุฑ ุฏููุ
**A:** ุฎุฑุ ุงูุง ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุญุงูุธูุ `conversation_id` ุฑุง ุงุฑุณุงู ฺฉูุฏ.

### Q: ููุฏูุง ุฌุฏุฏ ุงูุฒุงู ูุณุชูุฏุ
**A:** ุฎุฑุ ุงุฎุชุงุฑ ูุณุชูุฏ. ูโุชูุงูุฏ ูุงุฏุฏู ุจฺฏุฑุฏ.

### Q: ุฒูุงู ูพุฑุฏุงุฒุด ุชุบุฑ ฺฉุฑุฏูุ
**A:** ุจููุ 1-2 ุซุงูู ุจุดุชุฑ (ุจู ุฏูู ุชุญูู ูุงู ู ุญุงูุธู).

### Q: ูุญุฏูุฏุช ูุงู ุชุบุฑ ฺฉุฑุฏูุ
**A:** ุฎุฑุ ููฺูุงู ุญุฏุงฺฉุซุฑ 5 ูุงู.

---

**ููู ฺุฒ ุขูุงุฏู ุงุณุช!** ๐

ุงฺฏุฑ ุณูุงู ุฏุงุฑุฏุ ุจู ูุณุชูุฏุงุช ฺฉุงูู ูุฑุงุฌุนู ฺฉูุฏ:
`/srv/document/API_ENHANCED_GUIDE.md`
